var _typeof=typeof Symbol==='function'&&typeof Symbol.iterator==='symbol'?function(obj){return typeof obj}:function(obj){return obj&&typeof Symbol==='function'&&obj.constructor===Symbol&&obj!==Symbol.prototype?'symbol':typeof obj};function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError('Cannot call a class as a function')}}import'babel-polyfill';var Kensho=function(){var initialized=false;var Kensho=function(){function Kensho(formElement){_classCallCheck(this,Kensho);if(Kensho.instanceList===undefined){Kensho.instanceList=[this]}else{Kensho.instanceList.push(this)}formElement=typeof formElement==='string'?document.querySelector(formElement):formElement;if(formElement===null){console.error('form not found.');return false}this.formElement=formElement;this.rule=Kensho.rule;this.plugin=Kensho.plugin;this.hook=new Kensho.Hook;this.inputs={};if(Kensho.config.get('autocomplete'))formElement.setAttribute('autocomplete','off');formElement.classList.add('kensho-form')}Kensho.prototype.add=function add(inputElement,errorElement,rule){var _this=this;var event=arguments.length>3&&arguments[3]!==undefined?arguments[3]:[''];var unitName=arguments.length>4&&arguments[4]!==undefined?arguments[4]:'';if(typeof inputElement==='string'){inputElement=this.formElement.querySelectorAll(inputElement);inputElement=Array.prototype.map.call(inputElement,function(v){return v})}else if(Array.isArray(inputElement)){var arr=[];inputElement.forEach(function(val){val=typeof val==='string'?_this.formElement.querySelectorAll(val):val;val=Array.prototype.map.call(val,function(v){return v});val.forEach(function(v){arr.push(v)})});inputElement=arr}else{inputElement=Array.prototype.map.call(inputElement,function(v){return v})}errorElement=typeof errorElement==='string'?this.formElement.querySelector(errorElement):errorElement;event=typeof event==='string'?event.split('|'):!event?['']:event;var name=unitName?unitName:inputElement[0].getAttribute('name');var tagName=inputElement[0].tagName.toLowerCase();var type=null;if(tagName==='input')type=inputElement[0].getAttribute('type');else type=tagName;switch(type){case'password':type='text';break;case'search':type='text';break;case'tel':type='text';break;case'email':type='text';break;case'url':type='text';break;case'number':type='text';break;}var _rule={};for(var key in rule){if(typeof rule[key]==='string'){_rule[key]={param:{},errorMessage:rule[key]}}else{_rule[key]=rule[key]}}rule=_rule;var unit={name:name,inputElement:inputElement,errorElement:errorElement,inputTagName:tagName,type:type,rule:rule,error:[]};unit=this.hook.filter('validate-unit',unit);this.inputs[name]=unit;event.forEach(function(name,i){if(name==='init'){_this.validate(unit.name)}else{unit.inputElement.forEach(function(elm){elm.addEventListener(name,function(){_this.validate(unit.name)})})}});this.hook.action('set-validate-unit',{unit:unit});return this};Kensho.prototype.hasError=function hasError(){var _=this._.get(this);var result=false;for(var key in _.inputs){if(_.inputs[key].error.length!==0){result=true;break}}return result};Kensho.prototype.allValidate=function allValidate(){var _this2=this;Object.keys(this.inputs).map(function(key,i){_this2.validate(key)})};Kensho.prototype.validate=function validate(name){var _this3=this;var unit=this.inputs[name];var inputElement=unit.inputElement;var applyRules=unit.rule;var verbose=Kensho.config.get('verbose');var wrapTag=Kensho.config.get('errorMessageWrapper');var errorClassName=Kensho.config.get('errorClassName');unit.errorElement.innerHTML='';unit.errorElement.classList.remove(errorClassName);unit.error=[];unit.inputElement.forEach(function(elm){elm.classList.remove('invalid');elm.classList.remove('valid')});var _loop=function _loop(ruleName){var _val=void 0;var values=[];var ruleParam=applyRules[ruleName]['param'];inputElement.filter(function(elm){if(unit.type==='radio'){_val=elm.checked}else if(unit.type==='checkbox'){_val=elm.checked}else{_val=elm.value}_val=_this3.hook.filter('validate-val--'+unit.type,_val);values.push(_val)});var result=Kensho.rule.get(ruleName)(values,ruleParam,unit.type);if(!result){var message=document.createTextNode(applyRules[ruleName].errorMessage).nodeValue;message=message.replace(/\<+script[\s\S]*\/script[^>]*>/img,'');unit.error.push('<'+wrapTag+' class="kensho-error-message">'+message+'</'+wrapTag+'>');if(!verbose)return'break'}};for(var ruleName in applyRules){var _ret=_loop(ruleName);if(_ret==='break')break}if(unit.error.length){unit.errorElement.classList.add(errorClassName);unit.errorElement.innerHTML=unit.error.join('\n');unit.inputElement.forEach(function(elm){elm.classList.add('invalid')})}else{unit.inputElement.forEach(function(elm){elm.classList.add('valid')})}return this};Kensho.validate=function validate(name,value){var param=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{};var rule=this.rule.get(name);var result=true;if(result)result=rule(value,param);return result};return Kensho}();return Kensho}();(function(){var _c={};_c.errorMessageWrapper='span';_c.verbose=true;_c.errorClassName='kensho-has-error';_c.autocomplete=true;_c.HTML5novalidate=true;Kensho.config={get:function get(key){return _c[key]},set:function set(key,val){if((typeof key==='undefined'?'undefined':_typeof(key))==='object')for(var _k in key){this.set(_k,key[_k])}_c[key]=val}}})();(function(){var Hook=function(){function Hook(){_classCallCheck(this,Hook);this.actions={};this.filters={}}Hook.prototype.add=function add(type,hookName,callbackName,callback){var priority=arguments.length>4&&arguments[4]!==undefined?arguments[4]:-1;var hooks=void 0;switch(type){case'action':hooks=this.actions;break;case'filter':hooks=this.filters;break;}if(!hooks[hookName])hooks[hookName]=[];var newCallback={name:callbackName,callback:callback};if(priority<0){hooks[hookName].push(newCallback)}else{hooks[hookName].splice(priority,0,newCallback)}return this};Hook.prototype.remove=function remove(type,hookName,callbackName){var hooks=void 0;switch(type){case'action':hooks=this.actions;break;case'filter':hooks=this.filters;break;}try{hooks[hookName]=hooks[hookName].filter(function(hook){return hook.name!==callbackName});if(!hooks[hookName].length)delete hooks[hookName]}catch(e){console.error(e)}return this};Hook.prototype.action=function action(hookName){var param=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var thisObject=arguments.length>2&&arguments[2]!==undefined?arguments[2]:this;var callbacks=this.actions[hookName];if(callbacks)callbacks.forEach(function(listener){return listener.callback.call(thisObject,param)})};Hook.prototype.filter=function filter(hookName,data){var thisObject=arguments.length>2&&arguments[2]!==undefined?arguments[2]:this;var callbacks=this.filters[hookName];if(callbacks){callbacks.forEach(function(listener){data=listener.callback.call(thisObject,data)})};return data};return Hook}();Kensho.Hook=Hook})();(function(){var rule=Object.create(null);var ruleBook={};rule.add=function(name,callback){ruleBook[name]=callback};rule.remove=function(name){delete ruleBook[name];return this};rule.get=function(name){return ruleBook[name]};Kensho.rule=rule})();(function(){var plugin=Object.create(null);var list={};plugin.add=function(name,func){var param=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{};list[name]={'name':name,'func':func,'param':param};return this};plugin.remove=function(name){delete list[name];return this};plugin.get=function(name){return list[name]};Kensho.plugin=plugin})();(function(){var rule=Kensho.rule;var requiredFunc=function requiredFunc(val){var param=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var type=arguments.length>2&&arguments[2]!==undefined?arguments[2]:'';if(Array.isArray(val)){var result=void 0;if(type==='radio'||type==='checkbox'){result=false;val.forEach(function(v){if(v)result=true})}else{result=true;val.forEach(function(v){if(!requiredFunc(v,param,type,type))result=false})}return result}else{var trimFlg=param.trim===true?true:false;if(typeof val==='boolean')return val;if(trimFlg)val=val.trim();return val?true:false}};Kensho.rule.add('required',requiredFunc)})();(function(){var rule=Kensho.rule;rule.add('fullsize',function(val){var param=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var result=true;var is2byte=Kensho.plugin.get('is2byte');for(var i=0,l=val.length;i<l;i++){if(!is2byte.func(val[i])){result=false;break};}return result})})();(function(){var rule=Kensho.rule;var halfsizeFunc=function halfsizeFunc(val){var param=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var type=arguments.length>2&&arguments[2]!==undefined?arguments[2]:'';var result=true;var is1byte=Kensho.plugin.get('is1byte').func;for(var i=0,l=val.length;i<l;i++){if(!is1byte.func(val[i])){result=false;break};}return result};rule.add('halfsize',halfsizeFunc)})();(function(){var rule=Kensho.rule;var numberFunc=function numberFunc(val){var param=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var type=arguments.length>2&&arguments[2]!==undefined?arguments[2]:'';if(Array.isArray(val)){var result=true;val.forEach(function(v){if(!numberFunc(v,param,type))result=false});return result}else{var allow2byteFlg=typeof param.allow2byte==='boolean'?param.allow2byte:false;var trimFlg=typeof param.trim==='boolean'?param.trim:false;var empty=typeof param.empty==='boolean'?param.empty:true;var signed=typeof param.signed==='boolean'?param.signed:false;var point=typeof param.point==='boolean'?param.point:false;var full2half=Kensho.plugin.get('full2half');if(allow2byteFlg)val=full2half.func(val);if(trimFlg)val=val.trim();if(val.length===0&&empty)return true;var regExpText='^';var regExpPtn=['0-9'];if(signed)regExpText+='[-+]?';if(point)regExpPtn.push('.');regExpText+='['+regExpPtn.join('')+']+';regExpText+='[0-9]$';var regExp=new RegExp(regExpText);if(!regExp.test(val))return false;return true}};rule.add('number',numberFunc)})();(function(){var rule=Kensho.rule;var ageFunc=function ageFunc(val){var param=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var type=arguments.length>2&&arguments[2]!==undefined?arguments[2]:'';if(Array.isArray(val)){var result=true;val.forEach(function(v){if(!ageFunc(v,param,type))result=false});return result}else{var maxAge=param.maxAage?param.maxAage:125;var allow2byteFlg=typeof param.allow2byte==='boolean'?param.allow2byte:false;var trimFlg=typeof param.trim==='boolean'?param.trim:false;var empty=typeof param.empty==='boolean'?param.empty:true;var full2half=Kensho.plugin.get('full2half');var numberRule=Kensho.rule.get('number');var _result=true;_result=numberRule(val,{'allow2byte':allow2byteFlg,'trim':trimFlg,'empty':empty,'signed':false,'point':false},type);if(!_result)return false;if(allow2byteFlg)val=full2half.func(val);if(trimFlg)val=val.trim();if(val.length===0&&empty)return true;if(!/^[0-9]{1,3}$/.test(val))return false;if(val.length!==1&&/^0/.test(val))return false;if(val>maxAge)return false;return true}};rule.add('age',ageFunc)})();(function(){var rule=Kensho.rule;var emailFunc=function emailFunc(val){var param=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var type=arguments.length>2&&arguments[2]!==undefined?arguments[2]:'';if(Array.isArray(val)){var result=true;val.forEach(function(v){if(!emailFunc(v,param,type))result=false});return result}else{var _result2=true;var halfsizeRule=Kensho.rule.get('halfsize');_result2=halfsizeRule(val,{},type);var re=/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;return re.test(val)}};rule.add('email',emailFunc)})();(function(){var rule=Kensho.rule;rule.add('blacklist',function(val,param){var result=true;if(!param.list)return result;for(var i=0,l=param.list.length;i<l;i++){var reg=new RegExp(param.list[i]);if(reg.test(val)){result=false;break}}return result})})();(function(){var rule=Kensho.rule;rule.add('whitelist',function(val,param){var result=false;if(!param.list)return result;for(var i=0,l=param.list.length;i<l;i++){var reg=new RegExp(param.list[i]);if(reg.test(val)){result=true;break}}return result})})();(function(){var rule=Kensho.rule;rule.add('match',function(val,param){param=typeof param==='string'?document.querySelector(param):param;return param.value===val})})();(function(){var maps={};maps=Object.assign(maps,{'\uFF10':'0','\uFF11':'1','\uFF12':'2','\uFF13':'3','\uFF14':'4','\uFF15':'5','\uFF16':'6','\uFF17':'7','\uFF18':'8','\uFF19':'9'});maps=Object.assign(maps,{'\uFF41':'a','\uFF42':'b','\uFF43':'c','\uFF44':'d','\uFF45':'e','\uFF46':'f','\uFF47':'g','\uFF48':'h','\uFF49':'i','\uFF4A':'j','\uFF4B':'k','\uFF4C':'l','\uFF4D':'m','\uFF4E':'n','\uFF4F':'o','\uFF50':'p','\uFF51':'q','\uFF52':'r','\uFF53':'s','\uFF54':'t','\uFF55':'u','\uFF56':'v','\uFF57':'w','\uFF58':'x','\uFF59':'y','\uFF5A':'z'});maps=Object.assign(maps,{'\uFF21':'A','\uFF22':'B','\uFF23':'C','\uFF24':'D','\uFF25':'E','\uFF26':'F','\uFF27':'G','\uFF28':'H','\uFF29':'I','\uFF2A':'J','\uFF2B':'K','\uFF2C':'L','\uFF2D':'M','\uFF2E':'N','\uFF2F':'O','\uFF30':'P','\uFF31':'Q','\uFF32':'R','\uFF33':'S','\uFF34':'T','\uFF35':'U','\uFF36':'V','\uFF37':'W','\uFF38':'X','\uFF39':'Y','\uFF3A':'Z'});maps=Object.assign(maps,{'\uFF0D':'-','\uFF08':'(','\uFF09':')','\uFF3F':'_','\uFF0F':'/','\uFF0B':'+','\uFF1A':':','\uFF1B':';','\uFF3D':']','\uFF3B':'[','\uFF20':'@','\uFF01':'!','\uFF1C':'<','\uFF1E':'>','\uFF1F':'?','\uFF5B':'{','\uFF5D':'}','\uFF0A':'*','\u201D':'"','\u2019':'\'','\u301C':'~','\uFF3E':'^','\uFFE5':'\xA5','\uFF5C':'|','\uFF06':'&','\uFF05':'%','\uFF03':'#','\uFF04':'$','\u3000':' ','\uFF1D':'='});var full2half=function full2half(val){var result='';val.split('').forEach(function(s){s=maps[s]?maps[s]:s;result+=s});return result};full2half.addMap=function(userMap){maps=Object.assign(maps,userMap)};Kensho.plugin.add('full2half',full2half)})();(function(){var isNbyte=function isNbyte(half){return function(val){var code=val.charCodeAt(0);var f=code>=0&&code<129||code==63728||code>=65377&&code<65440||code>=63729&&code<63732;return!(f^half)}};Kensho.plugin.add('is1byte',isNbyte(true));Kensho.plugin.add('is2byte',isNbyte(false))})();if(typeof process!=='undefined'&&typeof require!=='undefined'){module.exports=Kensho}else{window.Kensho=Kensho}